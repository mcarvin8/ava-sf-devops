####################################################
# ContPar Org Jobs
# All deployment jobs for the ContPar environment
####################################################

test:predeploy:ContPar:
  extends: .validate-metadata
  stage: test
  resource_group: ContPar
  rules:
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == 'develop' || $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == 'fullqa' || $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == $CI_DEFAULT_BRANCH
      when: never
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == 'ContPar'
      when: manual
  allow_failure: false
  variables:
    AUTH_ALIAS: CONTPAR
    AUTH_URL: $CONTPAR_AUTH_URL
  environment:
    name: validate-ContPar
    url: https://avalara--contpar.sandbox.my.salesforce.com
  tags: 
    - aws,prd,us-west-2

deploy:ContPar:
  extends: .deploy-metadata
  stage: deploy
  resource_group: ContPar
  rules:
    - if: $CONT_DISABLED
      when: never
    - if: $CI_COMMIT_REF_NAME == 'ContPar' && $CI_PIPELINE_SOURCE == 'push'
      when: always
  allow_failure: false
  variables:
    AUTH_ALIAS: CONTPAR
    AUTH_URL: $CONTPAR_AUTH_URL
    GT_ANNOTATION_ENVIRONMENT: ContPar
  environment:
    name: ContPar
    url: https://avalara--contpar.sandbox.my.salesforce.com
  tags: 
    - aws,prd,us-west-2

destroy:ContPar:
  extends: .delete-metadata
  stage: destroy
  resource_group: ContPar
  rules:
    - if: $CONT_DISABLED
      when: never
    - if: $CI_COMMIT_REF_NAME == 'ContPar' && $CI_PIPELINE_SOURCE == 'web' && $PACKAGE
      when: always
  allow_failure: false
  variables:
    AUTH_ALIAS: CONTPAR
    AUTH_URL: $CONTPAR_AUTH_URL
    GT_ANNOTATION_ENVIRONMENT: ContPar
  environment:
    name: ContPar
    url: https://avalara--contpar.sandbox.my.salesforce.com
  tags: 
    - aws,prd,us-west-2

merge:ContPar:
  extends: .auto-merge
  stage: merge
  resource_group: merge-ContPar
  needs: []
  rules:
    - if: $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == 'develop' || $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == 'fullqa' || $CI_MERGE_REQUEST_SOURCE_BRANCH_NAME == $CI_DEFAULT_BRANCH
      when: never
    - if: $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == 'ContPar'
      when: manual
  allow_failure: false
  environment:
    name: ContPar
    url: https://avalara--contpar.sandbox.my.salesforce.com
  tags: 
    - aws,prd,us-west-2
