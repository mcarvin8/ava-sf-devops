#!/bin/bash
################################################################################
# Script: post_test_result.sh
# Description: Posts test result notifications to Slack using the payload
#              generated by parse_test_result.sh. Reads the slackPayload.json
#              file and sends it to the configured Slack webhook.
# Usage: Called from CI/CD pipeline after parse_test_result.sh
# Dependencies: curl
# Environment Variables Required:
#   - SLACK_WEBHOOK: Slack webhook URL for posting messages
# Input: slackPayload.json (generated by parse_test_result.sh)
################################################################################
set -euo pipefail

function share_slack_update_build() {
    local slack_webhook
    slack_webhook="$SLACK_WEBHOOK"
    local payload_file="slackPayload.json"

    # Check if the payload file exists
    if [[ ! -f "${payload_file}" ]]; then
        echo "Error: Payload file '${payload_file}' not found."
        exit 1
    fi

    # Read the JSON payload from the file
    local payload
    payload=$(cat "${payload_file}")

    curl -X POST \
        --data-urlencode "payload=${payload}" \
        "${slack_webhook}"
}
